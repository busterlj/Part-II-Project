<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><!-- $Id$ -->
        
        <meta http-equiv="CONTENT-TYPE" content="text/html; charset=us-ascii" />
        
        <title>Audiveris Implementation Manual</title><meta name="AUTHOR" content="Herv&#195;&#169; Bitteur" />
        <meta name="CLASSIFICATION" content="Implementation Documentation of Audiveris" />
        <meta name="DESCRIPTION" content="Description of Audiveris techniques" /><!-- The following links are meant to be solved on my local PC --><!-- The java.net site uses its own style sheets -->

        
        
        <link rel="stylesheet" type="text/css" href="../../branding/css/tigris.css" />
        <link rel="stylesheet" type="text/css" href="../../branding/css/inst.css" />
        <script type="text/javascript" src="util.js">
</script>
        <style type="text/css">
/*<![CDATA[*/
        .holder {color: blue; font-style: italic;}
        h2 {background-color: #d4e4b4 ;}
        body.c5 {text-align: justify;}
        div.c4 {margin-left: 2em}
        p.c3 {font-style: italic}
        li.c2 {list-style: none; display: inline}
        h1.c1 {text-align: center}
        div.c2 {margin-left: 2em}
        li.c1 {list-style: none; display: inline}
        .framed {border: 1px solid #ff0000;}
        div.comment {display: inline; font-style: italic; font-size: smaller;
                 color: gray;}
        /*]]>*/
        </style></head>
<body class="app c5">

        <h1 class="c1">
            Audiveris Implementation Manual
        </h1>
        <p>
            Purpose of this implementation manual is to help any programmer's
            task: understanding the source code, modifying existing functions,
            adding new features, etc...
        </p>

        <h2>
	    <a name="MAIN_ITEMS" id="MAIN_ITEMS">Main Items</a>
	</h2>
        <ul>
            <li>Techniques
                <ul>
                    <li>
                        <strong>Linear Adjacency Graphs</strong> (LAG) record
                        pixel information as a directed graph structure,
                        composed of pixel contiguous runs organized in
                        sections.
                    </li>

                    <li>
                        <strong>Sticks</strong> are developed above LAGs to
                        take advantage of the structuring sticks of a music
                        sheet (staff lines, ledgers and legato signs are such
                        horizontal sticks, while stems and barlines are
                        vertical sticks).
                    </li>
                    <li>
                        <strong>A Neural Network</strong> allows efficient
                        pattern recognition as well as training based on user
                        input for continuous improvement of the tool
                        efficiency.
                    </li>
                </ul>
            </li>

            <li>Technologies
                <ul>
                    <li>
                        <strong>Java Advanced Imaging</strong> (JAI) for number
                        crunching in image processing (See <a href="http://java.sun.com/javase/technologies/desktop/media/jai/">
                        http://java.sun.com/javase/technologies/desktop/media/jai/</a>)
                    </li>
                    <li>
                        <strong>Swing</strong> for user interface, enhanced
                        with <strong>JGoodies</strong> (See <a href="https://looks.dev.java.net/">https://looks.dev.java.net/</a>

                        and <a href="https://forms.dev.java.net/">https://forms.dev.java.net/</a>)
                    </li>
                    <li>
                        <strong>Swing Application Framework</strong> for
                        lifecycle, actions, etc.
                    </li>
                    <li>
                        <strong>EventBus</strong> for decoupling UI events (See
                        <a href="https://eventbus.dev.java.net/">https://eventbus.dev.java.net/</a>)
                    </li>

                    <li>
                        <strong>JFreeChart</strong> for charts (See <a href="http://www.jfree.org/jfreechart/">http://www.jfree.org/jfreechart/</a>)
                    </li>
                    <li>
                        <strong>JAXB 2</strong> for XML persistency (See
                        <a href="https://jaxb.dev.java.net/">https://jaxb.dev.java.net/</a>)
                    </li>

                    <li>
                        <strong>Jama</strong> for linear algebra (See <a href="http://math.nist.gov/javanumerics/jama/">http://math.nist.gov/javanumerics/jama/</a>)
                    </li>
                    <li>
                        <strong>Java&nbsp;6</strong>.
                    </li>
                </ul>

            </li>
            <li>Companions
                <ul>
                    <li>
                        <strong>ProxyMusic</strong> is a separate project,
                        dedicated to the marshalling between Java objects and
                        MusicXML files. (See <a href="http://kenai.com/projects/proxymusic">http://kenai.com/projects/proxymusic</a>)
                    </li>
                    <li>
                        <strong>Zong! </strong>is a project owned by Andreas
                        Wenger, to provide a Java MIDI player interface to
                        MusicXML content. It replaces the former <strong style="font-weight: normal;">XenoPlay</strong>&nbsp;player (see <a href="http://www.xenoage.com/zongplayer.html">http://www.xenoage.com/zongplayer.html</a>)&nbsp;
                    </li>

                    <li>
                        <strong>Tesseract</strong> is the well known
                        open-source OCR released by Google. (See <a href="http://code.google.com/p/tesseract-ocr/">http://code.google.com/p/tesseract-ocr/</a>)<br />

                        Under Windows and Linux, it is accessed via a JNI interface
                        provided by <strong>Tesjeract</strong> project of Bahri
                        Gencsoy. (See <a href="http://code.google.com/p/tesjeract/">http://code.google.com/p/tesjeract/</a>)
                    </li>

                    <li>
                        <strong>Java look and feel Graphics Repository</strong>
                        is a collection of toolbar button graphics. (See
                        <a href="http://java.sun.com/developer/techDocs/hi/repository/">
                        http://java.sun.com/developer/techDocs/hi/repository/</a>)
                    </li>
                </ul>
            </li>
            <li>Cocomo
                <ul>

                    <li>This Java stand-alone application is made of 420
                    classes and 130_000 lines of commented Java code. In the
                    little table below, selecting "code only" gives the most
                    realistic estimate :-)<br />
                        <br />
                        <script type="text/javascript" src="http://www.ohloh.net/p/3072/widgets/project_cocomo.js">
</script>
                    </li>
                </ul>
            </li>
        </ul>
        <h2>

            <a name="FOLDERS" id="FOLDERS">Folders</a>
        </h2>
        <h3>
            <a name="HIERARCHY" id="HIERARCHY">
		Folders Hierarchy</a>
        </h3>
                    <table>

                        <caption>
                            Full distribution
                        </caption>
                        <tbody><tr>
                            <td>
                                <img class="framed" src="../images/hierarchy-full.png" alt="Folder hierarchy for full distribution" title="Hierarchy of folders from full distribution" />
                            </td>
                        </tr>
                    </tbody></table>
        <h3>
            <a name="DETAILS" id="DETAILS">
		Folders Details</a>
        </h3>

        <div class="filebrowse">
            <ul>
                <li class="leaf">build-for-netbeans.xml
                    <div class="comment">
                        -- File to be renamed "build.xml", when NetBeans is
                        used
                    </div>
                </li>
                <li class="leafnode">config/
                    <div class="comment">
                        -- Local configuration data (supersedes default
                        "config/" resource located in Audiveris jar file)
                    </div>

                    <ul>
                        <li class="leaf">ISO639-3.xml
                            <div class="comment">
                                -- Definition of language codes for text glyphs
                            </div>
                        </li>
                        <li class="leaf">linear-evaluator.xml
                            <div class="comment">
                                -- Disk backup of linear evaluator (this file
                                is created or rewritten when the evaluator is
                                retrained)
                            </div>
                        </li>

                        <li class="leaf">logging.properties
                            <div class="comment">
                                -- Properties to govern log actions
                            </div>
                        </li>
                        <li class="leaf">neural-network.xml
                            <div class="comment">
                                -- Disk backup of neural network evaluator
                                (this file is created or rewritten when the
                                network is retrained)
                            </div>
                        </li>
                        <li class="leaf">run.default.properties
                            <div class="comment">

                                -- System-defined application constants (they
                                override source definitions, but are overridden
                                by definitions in ${user.home})
                            </div>
                        </li>
                        <li class="leaf">system-actions.xml
                            <div class="comment">
                                -- Default definition of pull-down menus
                            </div>
                        </li>
                        <li class="leaf">user-actions.xml
                            <div class="comment">
                                -- User additions in pull-down menus
                            </div>

                        </li>
                    </ul>
                </li>
                <li class="leafnode">dist/
                    <ul>
                        <li class="leaf">audiveris-3.3.jar
                            <div class="comment">
                                -- The application jar file
                            </div>
                        </li>

                        <li class="leaf">audiveris.bat
                            <div class="comment">
                                -- A convenient launcher of the application jar
                                file
                            </div>
                        </li>
                        <li class="leafnode">lib/
                            <div class="comment">
                                -- All jars referenced from Audiveris manifest (the actual content may vary)
                            </div>
                            <ul>
                                <li class="leaf">AppFramework.jar
                                    <div class="comment">

                                        -- Swing Application Framework
                                    </div>
                                </li>
                                <li class="leaf">BareBonesBrowserLaunch.jar
                                    <div class="comment">
                                        -- Launch of a browser on a local file
                                    </div>
                                </li>
                                <li class="leaf">clibwrapper_jiio.jar
                                    <div class="comment">
                                        -- Part of JAI
                                    </div>

                                </li>
                                <li class="leaf">EventBus-1.2.jar
                                    <div class="comment">
                                        -- Bus for event notifications
                                    </div>
                                </li>
                                <li class="leaf">forms-1.0.6.jar
                                    <div class="comment">
                                        -- JGoodies forms
                                    </div>
                                </li>

                                <li class="leaf">jai_codec.jar
                                    <div class="comment">
                                        -- Part of JAI
                                    </div>
                                </li>
                                <li class="leaf">jai_core.jar
                                    <div class="comment">
                                        -- Part of JAI
                                    </div>
                                </li>
                                <li class="leaf">jai_imageio.jar
                                    <div class="comment">

                                        -- Part of JAI
                                    </div>
                                </li>
                                <li class="leaf">Jama-1.0.2.jar
                                    <div class="comment">
                                        -- Matrix package for linear algebra
                                    </div>
                                </li>
                                <li class="leaf">jcommon-1.0.16.jar
                                    <div class="comment">
                                        -- Utilities for JFreeChart
                                    </div>

                                </li>
                                <li class="leaf">jfreechart-1.0.13.jar
                                    <div class="comment">
                                        -- Chart generation
                                    </div>
                                </li>
                                <li class="leaf">jlfgr-1_0.jar
                                    <div class="comment">
                                        -- Java Look &amp; Feel Graphics
                                    </div>

                                </li>
                                <li class="leaf">looks-2.0.1.jar
                                    <div class="comment">
                                        -- JGoodies look and feel
                                    </div>
                                </li>
                                <li class="leaf">mlibwrapper_jai.jar
                                    <div class="comment">
                                        -- Part of JAI
                                    </div>
                                </li>

                                <li class="leaf">PDFRenderer.jar
                                    <div class="comment">
                                        -- For reading PDF input images
                                    </div>
                                </li>
                                <li class="leaf">proxymusic-2.0.jar
                                    <div class="comment">
                                        -- Marshalling Java objects from/to
                                        MusicXML
                                    </div>
                                </li><li class="leaf">gervill.jar
                                    <div class="comment">

                                        -- Needed by Zong! player
                                    </div>
                                </li><li class="leaf">tesjeract.jar
                                    <div class="comment">

                                        -- Connection to Tesseract OCR
                                    </div>
                                </li><li class="leaf">zong.jar
                                    <div class="comment">
                                        -- MIDI sequencer
                                    </div>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </li>
                <li class="leafnode">examples/
                    <div class="comment">
                        -- A few examples of input images
                    </div>
                </li><li class="leafnode">ocr/
                    <div class="comment">
                        -- Tesseract material&nbsp;
                    </div>

                    <ul>
                        <li class="leaf">tesjeract.dll
                            <div class="comment">
                                -- Connection to tessdll.dll under Windows
                            </div>
                        </li>
                        <li class="leafnode">tessdata/
                            <div class="comment">
                                -- Runtime data for Tesseract
                            </div>
                            <ul>

                                <li class="leafnode">configs/
                                    <ul>
                                        <li class="leaf">api_config
                                            <div class="comment">
                                                -- Empty file (but needed)
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                                <li class="leaf">

                                    <div class="comment">
                                        -- A set of data files for each
                                        supported language
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li class="leaf">tessdll.dll
                            <div class="comment">
                                -- Tesseract DLL under Windows
                            </div>

                        </li>
                    </ul>
                </li>
                <li class="leafnode">src/
                    <div class="comment">
                        -- Source code and resources
                    </div>
                    <ul>
                        <li class="leaf">build-common.xml
                            <div class="comment">

                                -- Targets used commonly by src/build.xml and
                                by NetBeans
                            </div>
                        </li>
                        <li class="leaf">build-utils.xml
                            <div class="comment">
                                -- Utility targets for build-common.xml
                            </div>
                        </li>
                        <li class="leaf">build.default.properties
                            <div class="comment">
                                -- Default build property values
                            </div>

                        </li>
                        <li class="leaf">build.properties
                            <div class="comment">
                                -- Customized build property values
                            </div>
                        </li>
                        <li class="leaf">build.xml
                            <div class="comment">
                                -- Main build file for building with Ant tool
                            </div>
                        </li>

                        <li class="leaf">java-convention.xml
                            <div class="comment">
                                -- Driving parameters for the Jalopy tool to
                                pretty-format the Java sources
                            </div>
                        </li>
                        <li class="leafnode">main
                            <div class="comment">
                                -- Main source files
                            </div>
                        </li>
                        <li class="leafnode">plugins
                            <div class="comment">

                                -- User plugins source files
                            </div>
                        </li>
                        <li class="leafnode">test
                            <div class="comment">
                                -- Unit test source files
                            </div>
                        </li>
                    </ul>
                </li>

                <li class="leafnode">symbols/
                    <div class="comment">
                        -- Definitions of shape symbols, used for display &amp;

                        training
                    </div>
                    <ul><li class="leaf">.glyphignore
                            <div class="comment">
                                -- File names to ignore for training
                            </div>
                        </li><li class="leaf">
                            <div class="comment">

                                -- One or several xml file(s) for each shape
                            </div>
                        </li></ul>
                </li><li class="leafnode">train/
                    <div class="comment">
                        -- Training material for the evaluators
                    </div>
                    <ul>
                        <li class="leafnode">core
                            <div class="comment">
                                -- A selected subset of the glyph material,
                                representing the "core" of the training
                                material.
                            </div>
                        </li>
                        <li class="leafnode">sheets
                            <div class="comment">

                                -- The whole base of glyph material, with one
                                folder for each training sheet
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="leafnode">www/
                    <div class="comment">
                        -- Documentation folder
                    </div>
                    <ul>

                        <li class="leafnode">branding/
                            <ul>
                                <li class="leafnode">css/
                                    <div class="comment">
                                        -- Tigris CSS files
                                    </div>
                                </li>
                                <li class="leafnode">images/
                                    <div class="comment">
                                        -- Icons for HTML pages
                                    </div>

                                </li>
                            </ul>
                        </li>
                        <li class="leafnode">docs/
                            <ul>
                                <li class="leafnode">api
                                    <div class="comment">
                                        -- JavaDoc files
                                    </div>
                                </li>

                                <li class="leafnode">images/
                                    <div class="comment">
                                        -- Snapshots of Audiveris UI
                                    </div>
                                </li>
                                <li class="leafnode">manual/
                                    <div class="comment">
                                        -- Documentation manuals
                                    </div>
                                </li>
                                <li class="leafnode">wiki/
                                    <div class="comment">

                                        -- Wiki for informal notes
                                    </div>
                                    <ul>
                                        <li class="leafnode">images/
                                            <div class="comment">
                                                -- Snapshots for Wiki items
                                            </div>
                                        </li>
                                        <li class="leaf">notebook.html
                                            <div class="comment">
                                                -- Tiddly Wiki
                                            </div>

                                        </li>
                                        <li class="leaf">wiki.css
                                            <div class="comment">
                                                -- Used by notebook.html
                                            </div>
                                        </li>
                                        <li class="leaf">wiki.js
                                            <div class="comment">
                                                -- Used by notebook.html
                                            </div>
                                        </li>

                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="leaf">index.html
                            <div class="comment">
                                -- Audiveris project home page on java.net
                            </div>
                        </li>
                    </ul>

                </li>
            </ul>
        </div>

        <h2>
            <a name="PLUGINS" id="PLUGINS">Plugins</a>
        </h2>

        <h3>
            <a name="PLUGIN_MECHANISM" id="PLUGIN_MECHANISM">Plugin
            Mechanism</a>
        </h3>
        <p>
            On audiveris main frame, all user actions trigerred via pulldown
            menus or via tool bar buttons are now implemented as plugins.
        </p>
        <p>
            These can be <i><b>system</b></i> plugins which are predefined in
            the Audiveris release, or can be <i><b>user</b></i> plugins
            supplied by the user himself as an added feature. The only
            difference between system and user plugins, besides their origin,
            is the fact they are referenced in
            <strong>config/system-actions.xml</strong> for the former, and in
            <strong>config/user-actions.xml</strong> for the latter.
        </p>

        <p>
            Let's take a (rather comprehensive) line taken out of
            system-actions.xml:
        </p>
        <pre>&lt;<b>action</b>
     <b>domain</b>="VIEW"<br />     <b>section</b>="EDIT"<br />     <b>class</b>="omr.glyph.ui.ViewParameters"<br />     <b>method</b>="toggleSections"<br />     <b>item</b>="javax.swing.JCheckBoxMenuItem"<br />     <b>button</b>="javax.swing.JToggleButton"<br />/&gt;<br /></pre>
        <p>
            This line can be read as follows: In the <strong>VIEW</strong>
            pulldown menu, insert in the section <strong>EDIT</strong> a menu
            item (precisely an instance of
            <strong>javax.swing.JCheckBoxMenuItem</strong>) with
            a <strong>javax.swing.JToggleButton</strong> button. The item should
            trigger the method <strong>toggleSections</strong> to be found in
            class <strong>omr.glyph.ui.ViewParameters</strong>.
        </p>
        <p>

            In the Java source code, the method (such as "toggleSections"
            above) must be annotated by the <strong>@Action</strong> annotation
            defined by the Swing Application Framework.
        </p>
        <p>
            Visual characteristics for this action must be specified in the
            related <strong>resources/ViewParameters.properties</strong>
            resource file.<br />
            Depending on your locale setting, you may have a specific
            additional properties file, for example
            <strong>resources/ViewParameters_fr_FR.properties</strong> for the
            French locale, to override default characteristics.
        </p>

        <p>
            In these properties files, keys are built by using the method name,
            appended with ".Action.", followed by the Action characteristic
            identifier. The main characteristics identifiers are as follows
            (see the <code>javax.swing.Action</code> class for a comprehensive
            list):
        </p>
        <ul>
            <li>"text": for the menu item label
            </li>
            <li>"shortDescription": for the tool tip text
            </li>
            <li>"icon": for the icon both in menu and on tool bar
            </li>

            <li>"accelerator": for direct access
            </li>
        </ul>
        <h2>
            <a name="SHEET_SCORE" id="SHEET_SCORE">Sheet / Score</a>
        </h2>
        <h3>
            <a name="SHEET_VS_SCORE" id="SHEET_VS_SCORE">Sheet vs. Score</a>

        </h3>
        <p>
            A <b>Sheet</b> handles the physical entities as extracted from the
            printed music sheet, while the <b>Score</b> handles a structuring
            of the inferred logical entities. This distinction has led to the
            development of two separate packages, namely <i>omr.sheet</i> and
            <i>omr.score</i>.
        </p>

        <p>
            Many entities of one package have their counterpart in the other
            package, with link from one instance to the other.
        </p>
        <p>
            The following table lists the corresponding entities in
            <i>omr.sheet</i> and in <i>omr.score</i> packages, together with
            the Builder class that is in charge of extracting these entities :
        </p>
        <ul>

            <li>For example, an instance of <b>Score</b> class is the
            counterpart of an instance of <b>Sheet</b> class. (We assume that
            several printed pages can be combined as a mosaic beforehand (a
            feature not yet fully implemented), so that we have to process just
            one long <b>Sheet</b>).
            </li>
            <li>The next line states that a <b>System</b> in the
            <i>omr.score</i> package is the counterpart of a <b>SystemInfo</b>

            in the <i>omr.sheet</i> package, and that the class
            <b>BarsBuilder</b> is in charge of processing them.
            </li>
        </ul>
        <table>
            <tbody><tr>
                <th>

                    from omr.score package
                </th>
                <th>
                    from omr.sheet package<br />
                    (model&nbsp;classes)
                </th>
                <th>
                    from omr.sheet package<br />

                    (builder&nbsp;classes)
                </th>
            </tr>
            <tr>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/Score.html">
                    Score</a>
                </td>

                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/Sheet.html">
                    Sheet</a>
                </td>
            </tr>
            <tr>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/System.html">

                    System</a>
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/SystemInfo.html">
                    SystemInfo</a>
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/BarsBuilder.html">

                    BarsBuilder</a> handles the vertical lines that are
                    recognized as bar lines
                </td>
            </tr>
            <tr>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/Stave.html">
                    Stave</a>
                </td>

                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/StaveInfo.html">
                    StaveInfo</a>
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/LinesBuilder.html">
                    LinesBuilder</a> processes the stave areas, according to
                    the series of peaks found in the horizontal projection.
                </td>

            </tr>
            <tr>
                <td></td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/LineInfo.html">
                    LineInfo</a>
                </td>
                <td>

                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/LinesBuilder.html">
                    LineBuilder</a> processes the horizontal area that
                    corresponds to one histogram peak, and thus to one stave
                    line.
                </td>
            </tr>
            <tr>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/Measure.html">
                    Measure</a>

                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/BarInfo.html">
                    BarInfo</a>
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/BarsBuilder.html">
                    BarsBuilder</a> processes the vertical lines that are
                    recognized as bar lines.
                </td>

            </tr>
            <tr>
                <td></td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/Ledger.html">
                    Ledger</a>
                </td>
                <td>

                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/HorizontalsBuilder.html">
                    HorizontalsBuilder</a> retrieves horizontal dashes in the
                    given sheet. We use it for all horizontal glyphs (ledgers
                    of course, but also legato signs or alternate endings).
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/Ending.html">

                    Ending</a>
                </td>
                <td>
                    see HorizontalsBuilder above
                </td>
            </tr>
            <tr>
                <td></td>
                <td>

                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/stick/Stick.html">
                    Stick</a> (vertical)
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/VerticalsBuilder.html">
                    VerticalsBuilder</a> retrieves all the vertical sticks of
                    all systems in the sheet at hand. Bars are assumed to have
                    been already recognized, so this accounts for stems,
                    vertical edges of endings, and parts of alterations (sharp,
                    natural, flat).
                </td>
            </tr>

            <tr>
                <td></td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/glyph/Glyph.html">
                    Glyph</a>
                </td>
                <td>
                    <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/glyph/GlyphBuilder.html">

                    GlyphBuilder</a> gathers non-assigned remaining glyphs out
                    of a sheet.
                </td>
            </tr>
        </tbody></table>
        <h3>
            <a name="SHEET" id="SHEET">Sheet</a>
        </h3>
        <p>

            All the music entities are organized in Systems, read from left to
            right. Since <b>System</b> is actually an entity within the
            <i>omr.score</i> package, here in the <i>omr.sheet</i> package we
            use the class <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/SystemInfo.html">
            SystemInfo</a>.
        </p>
        <p>

            A <b>SystemInfo</b> is the repository for all physical entities
            found within the System, such as <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/glyph/Glyph.html">
            Glyph</a>'s, <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/BarInfo.html">
            BarInfo</a>'s, <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/Ledger.html">
            Ledger</a>'s, <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/sheet/StaveInfo.html">

            StaveInfo</a>'s, and the like.
        </p>
        <p>
            So, the general schema to browse through all sheet entities is
            usually similar to the following piece of code :
        </p>
        <pre>     for (SystemInfo system : sheet.getSystems()) {<br />         for (Glyph glyph : system.getGlyphs()) {<br />            // Do the glyph-based processing here<br />         }<br />     }<br /></pre>
        <p>
            All the entities that result from the phase called <b>Music
            Extraction</b> are made accessible through the collection of
            <b>SystemInfo</b> instances. The phase called <b>Music
            Recognition</b> should thus browse this collection and store its
            results in the <b>Score</b> entity.
        </p>

        <h3>
            <a name="SCORE" id="SCORE">Score</a>
        </h3>
        <p>
            The <b>Score</b> is organized as a hierarchy of instances of
            subclasses of <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/MusicNode.html">
            MusicNode</a>, rooted at the Score.
        </p>

        <p>
            Each <b>MusicNode</b> is a tree node, with a container and a list
            of children. To ease the traversal of the tree, every list of
            children, wherever found in the tree, is a list of homogeneous
            entities. So the Score hierarchy can be listed as follows :
        </p>
        <p>
	<img src="../api/omr/score/entity/doc-files/Visitable-Hierarchy.jpg" alt="Sketch of score entities" title="Visitable hierarchy of score entities" />
        </p>
        <p>
            The beginning of figure above can be read as follows :
        </p>

        <ul>
            <li>A <b>Score</b> has no container, and contains instances of
            class <b>System</b> as children.
            </li>
            <li class="c2">
                <ul>
                    <li>A <b>System</b> has <b>Score</b> as container, and
                    contains instances of class <b>SystemPart</b> as children.
                    </li>

                    <li class="c2">
                        <ul>
                            <li>A <b>SystemPart</b> has <b>System</b> as
                            container and exactly 4 children : one
                            <b>BarLine</b>, one <b>StaffList</b>, one
                            <b>MeasureList</b> and one <b>SlurList</b>.
                            </li>

                            <li class="c2">
                                <ol>
                                    <li>This (starting) <b>Barline</b> has <b>
                                        SystemPart</b> as container and no
                                        children.
                                    </li>
                                    <li>A <b>StaffList</b> has
                                    <b>SystemPart</b> as container and
                                    instances of <b>Staff</b>s as children.
                                    </li>

                                    <li>A <b>MeasureList</b> has
                                    <b>SystemPart</b> as container and
                                    instances of <b>Measure</b>s as children.
                                    </li>
                                    <li>A <b>SlurList</b> has <b>SystemPart</b>

                                    as container and instances of <b>Slur</b>s
                                    as children.
                                    </li>
                                </ol>
                            </li>
                            <li>Etc...
                            </li>
                        </ul>
                    </li>
                </ul>

            </li>
        </ul>
        <p>
            The hierarchical nature of this structure can be conveniently used
            by various traversals. It is used for example when the physical
            counterpart of each music node has to be rendered in the Sheet
            display (see method <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/MusicNode.html#renderNode%28java.awt.Graphics,%20omr.ui.Zoom%29">
            renderNode()</a>).
        </p>
        <p>
            Similarly, a <b>ScoreView</b> window handles the painting of Score
            entities, using method <a href="https://audiveris.dev.java.net/nonav/docs/api/omr/score/MusicNode.html#paintNode%28java.awt.Graphics%29">

            paintNode()</a>.
        </p>
        <p>
            A similar construction, coupled with JAXB, is used to store the
            content of a Score to the MusicXML format.
        </p>
    </body></html>